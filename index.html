<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>車両判定システム</title>
    <style>
        :root { --blue: #00479d; --red: #e60012; --bg: #f2f2f7; --gray: #444; }
        
        body { 
            font-family: -apple-system, sans-serif; 
            background: var(--bg); margin: 0; padding-bottom: 220px; 
            -webkit-user-select: none; 
        }

        /* ヘッダー：iPhoneのノッチ対応 */
        .header { 
            background: var(--blue); color: white; padding: 12px 15px; 
            text-align: center; border-bottom: 3px solid var(--red);
            position: sticky; top: 0; z-index: 1000;
            display: flex; justify-content: space-between; align-items: center;
        }
        .header h1 { margin: 0; font-size: 1rem; letter-spacing: 1px; }

        /* カテゴリ見出し */
        .section-title { 
            background: var(--gray); color: white; padding: 10px 15px; 
            font-weight: bold; font-size: 0.85rem; position: sticky; top: 48px; z-index: 999;
        }

        /* アイテム行：高さをしっかり確保 */
        .item { 
            display: flex; justify-content: space-between; align-items: center; 
            padding: 12px 15px; background: white; border-bottom: 1px solid #ddd; 
            min-height: 65px; box-sizing: border-box;
        }
        .item-n { font-size: 0.95rem; font-weight: bold; color: #333; }
        .pts-tag { color: var(--red); font-weight: bold; margin-left: 6px; font-size: 0.8rem; border: 1px solid var(--red); padding: 1px 4px; border-radius: 4px; }

        /* 操作ボタン：親指で押しやすい44pxサイズ */
        .ctrls { display: flex; align-items: center; gap: 12px; }
        .btn { 
            width: 46px; height: 46px; background: #fff; border: 1px solid #ccc; 
            font-size: 1.6rem; font-weight: bold; border-radius: 10px;
            box-shadow: 0 3px 0 #bbb; display: flex; align-items: center; justify-content: center;
        }
        .btn:active { transform: translateY(3px); box-shadow: none; background: #f0f0f0; }
        
        .qty-input { 
            width: 50px; height: 44px; text-align: center; border: 1px solid #ccc; 
            font-size: 1.3rem; font-weight: bold; border-radius: 8px; background: #fff;
        }

        /* フリー入力エリア */
        .free-row { padding: 15px; background: #fff; border-bottom: 1px solid #ddd; }
        .free-inputs { display: flex; gap: 10px; margin-bottom: 10px; }
        .free-name { flex: 2; padding: 12px; border: 1px solid #ccc; border-radius: 8px; font-size: 1rem; }
        .free-pts { flex: 1; padding: 12px; border: 1px solid #ccc; border-radius: 8px; font-size: 1rem; text-align: center; color: var(--red); font-weight: bold; }

        /* 固定フッター：計算結果を大きく表示 */
        .footer { 
            position: fixed; bottom: 0; width: 100%; background: white; 
            border-top: 5px solid var(--blue); z-index: 1001;
            padding-bottom: env(safe-area-inset-bottom);
            box-shadow: 0 -8px 20px rgba(0,0,0,0.15);
        }
        .price-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 5px; padding: 12px 10px 8px 10px; border-bottom: 1px solid #eee; }
        .price-box { text-align: center; background: #fdf2f2; padding: 5px; border-radius: 6px; }
        .price-label { font-size: 0.7rem; color: #555; font-weight: bold; }
        .price-val { font-size: 1.4rem; font-weight: bold; color: var(--red); }
        
        .footer-main { display: flex; justify-content: space-around; align-items: center; padding: 12px; }
        .total-box { text-align: center; border-right: 1px solid #eee; padding-right: 15px; }
        .res-v { font-size: 1.8rem; font-weight: bold; color: var(--blue); }
        .reset-btn { background: #555; color: white; border: none; padding: 15px 25px; border-radius: 10px; font-weight: bold; font-size: 1rem; }

        /* 管理者パネル */
        #admin-panel { 
            display: none; position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%);
            width: 92%; background: white; border-radius: 16px; 
            z-index: 2000; padding: 25px; box-sizing: border-box; box-shadow: 0 0 100px rgba(0,0,0,0.6); 
        }
        .admin-table { width: 100%; border-collapse: collapse; margin: 15px 0; }
        .admin-table th { font-size: 0.8rem; padding: 8px; color: #666; }
        .admin-table input { width: 100%; padding: 10px; border: 1px solid #ccc; border-radius: 6px; font-size: 1.1rem; text-align: right; }
        .admin-close { background: var(--blue); color: white; border: none; width: 100%; padding: 15px; border-radius: 10px; font-size: 1.1rem; font-weight: bold; }
    </style>
</head>
<body>

<div class="header">
    <h1>車両判定システム</h1>
    <button onclick="openAdmin()" style="font-size: 0.8rem; background:rgba(255,255,255,0.2); color:white; border:1px solid white; border-radius:6px; padding:6px 12px;">設定</button>
</div>

<div id="main-content">
    <div class="section-title">リビング・キッチン</div>
    <div id="list-living"></div>
    <div class="section-title">家具・家電</div>
    <div id="list-others"></div>
    <div class="section-title">資材</div>
    <div id="list-shizai"></div>
    <div class="section-title">フリー入力</div>
    <div id="list-free"></div>
</div>

<div class="footer">
    <div class="price-grid">
        <div class="price-box"><div class="price-label">通常料金</div><span id="price-standard" class="price-val">0</span><small style="color:var(--red); font-size:0.7rem">円～</small></div>
        <div class="price-box"><div class="price-label">指定料金</div><span id="price-reserved" class="price-val">0</span><small style="color:var(--red); font-size:0.7rem">円～</small></div>
    </div>
    <div class="footer-main">
        <div class="total-box"><small style="font-size:0.7rem; color:#666">合計点数</small><br><span id="total-pts" class="res-v">0</span><small style="font-size:0.8rem">P</small></div>
        <div class="total-box" style="border:none"><small style="font-size:0.7rem; color:#666">推奨車両</small><br><span id="truck-res" class="res-v" style="color:var(--red); font-size:1.3rem;">---</span></div>
        <button class="reset-btn" onclick="if(confirm('リセットしますか？')) location.reload()">クリア</button>
    </div>
</div>

<div id="admin-panel">
    <h3 style="margin:0 0 10px 0; text-align:center">料金単価設定</h3>
    <table class="admin-table">
        <tr><th>車両</th><th>通常</th><th>指定</th></tr>
        <tr><td>2T</td><td><input type="number" id="edit-2t-std"></td><td><input type="number" id="edit-2t-res"></td></tr>
        <tr><td>2TL</td><td><input type="number" id="edit-2tl-std"></td><td><input type="number" id="edit-2tl-res"></td></tr>
        <tr><td>3T</td><td><input type="number" id="edit-3t-std"></td><td><input type="number" id="edit-3t-res"></td></tr>
        <tr><td>複数</td><td><input type="number" id="edit-mt-std"></td><td><input type="number" id="edit-mt-res"></td></tr>
    </table>
    <button class="admin-close" onclick="saveAdmin()">設定を保存して閉じる</button>
</div>

<script>
// --- 商品データ ---
const dataLiving = [
    {n:"ソファー 1人掛け", p:9}, {n:"ソファー 2人掛け", p:22}, {n:"ソファー 3人掛け", p:50}, {n:"食器棚 特大", p:42}, {n:"冷蔵庫 5D", p:25}, {n:"食卓テーブル", p:4}, {n:"サイドボード", p:13}
];
const dataOthers = [
    {n:"洋服タンス", p:29}, {n:"和タンス", p:18}, {n:"ベッド 引出付", p:18}, {n:"洗濯機 ドラム", p:12}, {n:"自転車", p:15}, {n:"ダンボールA", p:1}, {n:"ダンボールB", p:2}
];
const dataShizai = [
    {n:"オリコン", p:1}, {n:"ハンガーBOX", p:7}, {n:"大型定数", p:15}, {n:"台車", p:3}
];

// 料金の保存・読み込み
let PRICE_TABLE = JSON.parse(localStorage.getItem('sys_prices_final')) || {
    "2T車": [15000, 18000], "2T車L": [20000, 24000], "3T車": [30000, 35000], "2台口以上": [45000, 52000]
};

let counter = 0;
function render(list, targetId) {
    const target = document.getElementById(targetId);
    list.forEach(item => {
        counter++;
        const id = 'q' + counter;
        const div = document.createElement('div');
        div.className = 'item';
        div.innerHTML = `<div><span class="item-n">${item.n}</span><span class="pts-tag">${item.p}P</span></div>
            <div class="ctrls"><button class="btn" onclick="chg('${id}',-1)">－</button>
            <input type="number" id="${id}" class="qty-input" value="0" data-pts="${item.p}" oninput="calc()">
            <button class="btn" onclick="chg('${id}',1)">＋</button></div>`;
        target.appendChild(div);
    });
}

function chg(id, d) {
    const el = document.getElementById(id);
    el.value = Math.max(0, (parseInt(el.value) || 0) + d);
    calc();
}

function calc() {
    let total = 0;
    // 通常リストの計算
    document.querySelectorAll('.qty-input[data-pts]').forEach(el => total += (parseInt(el.value)||0) * parseInt(el.dataset.pts));
    // フリー入力の計算
    for(let i=1; i<=3; i++) {
        const fq = document.getElementById('fq'+i);
        const fp = document.getElementById('fp'+i);
        if(fq && fp) total += (parseInt(fq.value)||0) * (parseInt(fp.value)||0);
    }
    document.getElementById('total-pts').innerText = total.toLocaleString();

    let truck = "---";
    if (total > 0 && total <= 200) truck = "2T車";
    else if (total > 200 && total <= 260) truck = "2T車L";
    else if (total > 260 && total <= 360) truck = "3T車";
    else if (total > 360) truck = "2台口以上";

    document.getElementById('truck-res').innerText = truck;
    if(truck !== "---" && PRICE_TABLE[truck]) {
        document.getElementById('price-standard').innerText = PRICE_TABLE[truck][0].toLocaleString();
        document.getElementById('price-reserved').innerText = PRICE_TABLE[truck][1].toLocaleString();
    } else {
        document.getElementById('price-standard').innerText = "0";
        document.getElementById('price-reserved').innerText = "0";
    }
}

function openAdmin() {
    if(prompt("パスワードを入力(初期1234)") === "1234") {
        document.getElementById('edit-2t-std').value = PRICE_TABLE["2T車"][0];
        document.getElementById('edit-2t-res').value = PRICE_TABLE["2T車"][1];
        document.getElementById('edit-2tl-std').value = PRICE_TABLE["2T車L"][0];
        document.getElementById('edit-2tl-res').value = PRICE_TABLE["2T車L"][1];
        document.getElementById('edit-3t-std').value = PRICE_TABLE["3T車"][0];
        document.getElementById('edit-3t-res').value = PRICE_TABLE["3T車"][1];
        document.getElementById('edit-mt-std').value = PRICE_TABLE["2台口以上"][0];
        document.getElementById('edit-mt-res').value = PRICE_TABLE["2台口以上"][1];
        document.getElementById('admin-panel').style.display = 'block';
    }
}

function saveAdmin() {
    PRICE_TABLE["2T車"] = [Number(document.getElementById('edit-2t-std').value), Number(document.getElementById('edit-2t-res').value)];
    PRICE_TABLE["2T車L"] = [Number(document.getElementById('edit-2tl-std').value), Number(document.getElementById('edit-2tl-res').value)];
    PRICE_TABLE["3T車"] = [Number(document.getElementById('edit-3t-std').value), Number(document.getElementById('edit-3t-res').value)];
    PRICE_TABLE["2台口以上"] = [Number(document.getElementById('edit-mt-std').value), Number(document.getElementById('edit-mt-res').value)];
    localStorage.setItem('sys_prices_final', JSON.stringify(PRICE_TABLE));
    document.getElementById('admin-panel').style.display = 'none';
    calc();
}

render(dataLiving, 'list-living');
render(dataOthers, 'list-others');
render(dataShizai, 'list-shizai');

for(let i=1; i<=3; i++) {
    const div = document.createElement('div');
    div.className = 'free-row';
    div.innerHTML = `<div class="free-inputs"><input type="text" class="free-name" placeholder="自由品名"><input type="number" id="fp${i}" class="free-pts" placeholder="P" oninput="calc()"></div><div class="ctrls" style="justify-content:flex-end;"><button class="btn" onclick="chg('fq${i}',-1)">－</button><input type="number" id="fq${i}" class="qty-input" value="0" oninput="calc()"><button class="btn" onclick="chg('fq${i}',1)">＋</button></div>`;
    document.getElementById('list-free').appendChild(div);
}
</script>
</body>
</html>
